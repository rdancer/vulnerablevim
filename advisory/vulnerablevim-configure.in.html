<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- Automatically generated by advisory/Makefile -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
<title>
Vim: Insecure Temporary File Creation During Build: Arbitrary Code Execution
</title>
</head>
<body>
<pre>
1. SUMMARY

Product  : Vim -- Vi IMproved
Versions : 5.0--current, possibly older; 4.6 and 3.0 not vulnerable
Impact   : Arbitrary code execution
Wherefrom: Local
Original : http://www.rdancer.org/vulnerablevim-configure.in.html
           http://www.rdancer.org/vulnerablevim-configure.in.patch

Insecure temporary file creation during the build process is vulnerable
to symbolic link attacks, and arbitrary code execution.  Patch provided.


2. BACKGROUND

  ``Vim is an almost compatible version of the UNIX editor Vi. Many new
    features have been added: multi-level undo, syntax highlighting,
    command line history, on-line help, spell checking, filename
    completion, block operations, etc.''

    		-- Vim README.txt 


3. VULNERABILITY

During the build process, a temporary file with a predictable name is
created in the ``/tmp'' directory.  This code is run when Vim is being
build with Python support:

src/configure.in:

    677         dnl -- we need to examine Python's config/Makefile too
    678         dnl    see what the interpreter is built from
    679         AC_CACHE_VAL(vi_cv_path_python_plibs,
    680         [
    681             tmp_mkf=&quot;/tmp/Makefile-conf$$&quot;
(1) 682             cat ${PYTHON_CONFDIR}/Makefile - &lt;&lt;'eof' &gt;${tmp_mkf}
    683 __:
    684         @echo &quot;python_MODLIBS='$(MODLIBS)'&quot;
    685         @echo &quot;python_LIBS='$(LIBS)'&quot;
    686         @echo &quot;python_SYSLIBS='$(SYSLIBS)'&quot;
    687         @echo &quot;python_LINKFORSHARED='$(LINKFORSHARED)'&quot;
    688 eof
    689             dnl -- delete the lines from make about Entering/Leaving directory
(2) 690             eval &quot;`cd ${PYTHON_CONFDIR} &amp;&amp; make -f ${tmp_mkf} __ | sed '/ directory /d'`&quot;
    691             rm -f ${tmp_mkf}

The attacker has to create the temporary file
``/tmp/Makefile-conf&lt;PID&gt;'' before it is first written to at (1).  In
the time between (1) and (2), arbitrary commands can be written to the
file.  They will be executed at (2).


3. TEST CASE

No test case.


4. PATCH

Patch fixing this vulnerability can be found at the following URL:

    http://www.rdancer.org/vulnerablevim-configure.in.patch

Please note: The patch fixes ``src/configure.in'', an input file used by
the ``autoconf'' command.  ``autoconf'' uses this input file to create
``src/auto/configure''.  It is necessary to remove the latter, if
present, to force its recreation.  Otherwise, further build runs will
still use it, and the vulnerability will still be present.


5. COPYRIGHT

This advisory is Copyright 2008 Jan Minar &lt;rdancer@rdancer.org&gt;

Copying welcome, under the Creative Commons ``Attribution-Share Alike''
License http://creativecommons.org/licenses/by-sa/2.0/uk/

Code included herein, and accompanying this advisory, may be copied
according to the GNU General Public License version 2, or the Vim
license.  See the subdirectory ``licenses''.

Various portions of the accompanying code were written by various
parties.  Those parties may hold copyright, and those portions may be
copied according to their respective licenses.


6. HISTORY

2008-07-18 Formatting changes
2008-07-17 Sent to: &lt;bugs@vim.org&gt;, &lt;vim-dev@vim.org&gt; 
	   &lt;full-disclosure@lists.grok.org.uk&gt;,
	   &lt;bugtraq@securityfocus.com&gt;
</pre>
</body>
</html>
